SELECT DISTINCT D.POSITION_NBR, D.EMPLID, D.NAME, F.AC_EMAIL, TO_CHAR(D.HIRE_DT,'YYYY-MM-DD'), TO_CHAR(D.SERVICE_DT,'YYYY-MM-DD'), D.JOBCODE, D.JOBCODE_DESCR, D.LOCATION, G.ADDRESS1, G.CITY, G.STATE, G.POSTAL, D.AC_BUSINESS_UNIT, D.AC_DESCR50, D.REPORTS_TO, D.SUPERVISOR_ID, D.AC_SUPER_NAME, E.AC_EXT_LVL01_NAME, E.AC_EXT_LVL02_NAME, E.AC_EXT_LVL03_NAME, E.AC_EXT_LVL04_NAME, E.AC_EXT_LVL05_NAME, E.AC_EXT_LVL06_NAME, E.AC_EXT_LVL07_NAME, E.AC_EXT_LVL08_NAME
  FROM PS_PSTREENODE_DW A, (SELECT TD.POSITION_NBR, TD.EMPLID, TD.NAME, TD.HIRE_DT, TD.SERVICE_DT, TD.JOBCODE, TD.JOBCODE_DESCR, TD.LOCATION, TD.AC_BUSINESS_UNIT, TD.AC_DESCR50, TD.REPORTS_TO, TD.SUPERVISOR_ID, TD.AC_SUPER_NAME
  FROM PS_AC_POSN_SBUD_VW TD,PS_AC_POSN_SRCH D1 WHERE TD.POSITION_NBR = D1.POSITION_NBR AND  D1.OPRCLASS = 'WIN_VW' ) D, PS_AC_REPTS_TO_LVL E, PS_AC_EMAIL_TBL F, PS_LOCATION_TBL G
  WHERE ( ( A.TREE_NODE_NUM >= (SELECT B.TREE_NODE_NUM
  FROM PS_PSTREENODE_DW B
  WHERE ( B.TREE_NODE = :1 ))
     AND A.TREE_NODE_NUM_END <= (SELECT C.TREE_NODE_NUM_END
  FROM PS_PSTREENODE_DW C
  WHERE ( C.TREE_NODE = :1 ))
     AND D.POSITION_NBR = A.TREE_NODE
     AND D.POSITION_NBR = E.POSITION_NBR
     AND D.JOBCODE NOT LIKE 'LC%'
     AND D.EMPLID =  F.EMPLID (+)
     AND G.LOCATION = D.LOCATION
     AND G.EFFDT =
        (SELECT MAX(G_ED.EFFDT) FROM PS_LOCATION_TBL G_ED
        WHERE G.SETID = G_ED.SETID
          AND G.LOCATION = G_ED.LOCATION
          AND G_ED.EFFDT <= SYSDATE) ))
