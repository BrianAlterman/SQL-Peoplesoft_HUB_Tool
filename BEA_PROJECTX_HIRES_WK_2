SELECT K.AC_EXT_LVL01_NAME, K.AC_EXT_LVL02_NAME, K.AC_EXT_LVL03_NAME, K.AC_EXT_LVL04_NAME, K.AC_EXT_LVL05_NAME, G.CITY, G.STATE, A.LOCATION, ':3', ':4', E.ACTION_DESCR, TO_CHAR(A.ACTION_DT,'YYYY-MM-DD'), TO_CHAR(A.EFFDT,'YYYY-MM-DD'), A.EFFSEQ, I.AC_BUSINESS_UNIT, J.DESCR, J.AC_CAT04, J.AC_CAT04_DESCR, TO_CHAR(D.ORIG_HIRE_DT,'YYYY-MM-DD'), TO_CHAR(A.HIRE_DT,'YYYY-MM-DD'), TO_CHAR(C.REHIRE_DT,'YYYY-MM-DD'), A.EMPLID, B.NAME, A.POSITION_NBR, A.JOBCODE, H.DESCR, A.BARG_UNIT, A.UNION_CD, F.DESCRSHORT, A.REPORTS_TO, K.NAME
  FROM (SELECT TA.LOCATION, TA.ACTION_DT, TA.EFFDT, TA.EFFSEQ, TA.HIRE_DT, TA.EMPLID, TA.POSITION_NBR, TA.JOBCODE, TA.BARG_UNIT, TA.UNION_CD, TA.REPORTS_TO, TA.PER_ORG, TA.ACTION, TA.ACTION_REASON, TA.EMPL_RCD
  FROM PS_JOB TA,PS_EMPLMT_SRCH_QRY A1 WHERE TA.EMPLID = A1.EMPLID AND TA.EMPL_RCD = A1.EMPL_RCD AND  A1.OPRID = 'E0182265' ) A, PS_PERSONAL_DATA B, PS_PERALL_SEC_QRY B1, PS_EMPLOYMENT C, PS_EMPLMT_SRCH_QRY C1, PS_PER_ORG_INST D, PS_PERS_SRCH_QRY D1, PS_ACTION_TBL E, PS_WIN_POSN_HIST F, PS_POSTN_SRCH_QRY F1, PS_LOCATION_TBL G, PS_JOBCODE_TBL H, PS_AC_HRMS I, PS_AC_JDE_CATCODE J, PS_AC_REPTS_TO_LVL K
  WHERE ( B.EMPLID = B1.EMPLID
    AND B1.OPRID = 'E0182265'
    AND C.EMPLID = C1.EMPLID
    AND C.EMPL_RCD = C1.EMPL_RCD
    AND C1.OPRID = 'E0182265'
    AND D.EMPLID = D1.EMPLID
    AND D1.OPRID = 'E0182265'
    AND F.POSITION_NBR = F1.POSITION_NBR
    AND F1.OPRID = 'E0182265'
    AND ( A.ACTION_DT BETWEEN TO_DATE(:1,'YYYY-MM-DD') AND TO_DATE(:2,'YYYY-MM-DD')
     AND A.PER_ORG = 'EMP'
     AND A.ACTION = 'DTA'
     AND A.ACTION_REASON = 'CVR'
     AND A.EMPLID = B.EMPLID
     AND A.EMPLID = C.EMPLID
     AND A.EMPLID = D.EMPLID
     AND E.ACTION = A.ACTION
     AND E.EFFDT =
        (SELECT MAX(E_ED.EFFDT) FROM PS_ACTION_TBL E_ED
        WHERE E.ACTION = E_ED.ACTION
          AND E_ED.EFFDT <= SYSDATE)
     AND F.EMPLID = A.EMPLID
     AND F.POSITION_NBR = A.POSITION_NBR
     AND F.EFFDT =
        (SELECT MAX(F_ED.EFFDT) FROM PS_WIN_POSN_HIST F_ED
        WHERE F.POSITION_NBR = F_ED.POSITION_NBR
          AND F.POSITION_ENTRY_DT = F_ED.POSITION_ENTRY_DT
          AND F.EMPLID = F_ED.EMPLID
          AND F.EMPL_RCD = F_ED.EMPL_RCD
          AND F_ED.EFFDT <= A.EFFDT)
    AND F.EFFSEQ =
        (SELECT MAX(F_ES.EFFSEQ) FROM PS_WIN_POSN_HIST F_ES
        WHERE F.POSITION_NBR = F_ES.POSITION_NBR
          AND F.POSITION_ENTRY_DT = F_ES.POSITION_ENTRY_DT
          AND F.EMPLID = F_ES.EMPLID
          AND F.EMPL_RCD = F_ES.EMPL_RCD
          AND F.EFFDT = F_ES.EFFDT)
     AND G.LOCATION = A.LOCATION
     AND G.EFFDT =
        (SELECT MAX(G_ED.EFFDT) FROM PS_LOCATION_TBL G_ED
        WHERE G.SETID = G_ED.SETID
          AND G.LOCATION = G_ED.LOCATION
          AND G_ED.EFFDT <= SYSDATE)
     AND H.JOBCODE = A.JOBCODE
     AND H.EFFDT =
        (SELECT MAX(H_ED.EFFDT) FROM PS_JOBCODE_TBL H_ED
        WHERE H.SETID = H_ED.SETID
          AND H.JOBCODE = H_ED.JOBCODE
          AND H_ED.EFFDT <= SYSDATE)
     AND I.EMPLID = A.EMPLID
     AND I.EMPL_RCD = A.EMPL_RCD
     AND I.EFFDT =
        (SELECT MAX(I_ED.EFFDT) FROM PS_AC_HRMS I_ED
        WHERE I.EMPLID = I_ED.EMPLID
          AND I.EMPL_RCD = I_ED.EMPL_RCD
          AND I_ED.EFFDT <= A.EFFDT)
    AND I.EFFSEQ =
        (SELECT MAX(I_ES.EFFSEQ) FROM PS_AC_HRMS I_ES
        WHERE I.EMPLID = I_ES.EMPLID
          AND I.EMPL_RCD = I_ES.EMPL_RCD
          AND I.EFFDT = I_ES.EFFDT)
     AND J.AC_BUSINESS_UNIT = I.AC_BUSINESS_UNIT
     AND J.EFFDT =
        (SELECT MAX(J_ED.EFFDT) FROM PS_AC_JDE_CATCODE J_ED
        WHERE J.AC_BUSINESS_UNIT = J_ED.AC_BUSINESS_UNIT
          AND J_ED.EFFDT <= SYSDATE)
     AND A.REPORTS_TO =  K.POSITION_NBR (+) ))
  ORDER BY 1, 2, 3, 4, 5, 12
